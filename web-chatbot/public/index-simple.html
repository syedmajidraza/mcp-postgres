<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostgreSQL MCP Chat</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Simple login styles */
        .simple-login-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 50px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .simple-login-container h1 {
            font-size: 32px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .simple-login-container p {
            color: #6b7280;
            margin-bottom: 40px;
            font-size: 16px;
        }

        .provider-selection {
            margin: 30px 0;
            text-align: left;
        }

        .provider-selection h3 {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f9fafb;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .radio-content {
            flex: 1;
        }

        .radio-label {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .radio-description {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
        }

        .provider-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        .start-button {
            width: 100%;
            padding: 16px 24px;
            margin-top: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .start-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* User info bar */
        .user-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .provider-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .badge-icon {
            font-size: 16px;
        }

        .logout-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginSection">
        <div class="simple-login-container">
            <h1>üêò PostgreSQL MCP Chat</h1>
            <p>Choose your AI provider to start chatting with your database</p>

            <div class="provider-selection">
                <h3>Select AI Provider</h3>

                <label class="radio-option" id="githubOption">
                    <input type="radio" name="provider" value="github" checked>
                    <div class="radio-content">
                        <div class="radio-label">
                            <svg class="provider-icon" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                            </svg>
                            GitHub Copilot
                        </div>
                        <div class="radio-description">
                            Uses GitHub Copilot AI for SQL generation. Powered by GPT-4.
                        </div>
                    </div>
                </label>

                <label class="radio-option disabled" id="msTeamsOption" style="opacity: 0.6; cursor: not-allowed;">
                    <input type="radio" name="provider" value="azure" disabled>
                    <div class="radio-content">
                        <div class="radio-label">
                            <svg class="provider-icon" viewBox="0 0 23 23" fill="currentColor">
                                <path d="M0 0h11v11H0z"/><path d="M12 0h11v11H12z"/><path d="M0 12h11v11H0z"/><path d="M12 12h11v11H12z"/>
                            </svg>
                            Microsoft Teams / Azure OpenAI
                            <span style="font-size: 11px; color: #f59e0b; margin-left: 8px; font-weight: 600;">üîí Requires Azure API Key</span>
                        </div>
                        <div class="radio-description">
                            Uses Azure OpenAI (same GPT-4 models as MS Teams). Requires Azure OpenAI API key and endpoint configuration.
                        </div>
                    </div>
                </label>

                <label class="radio-option" id="chatgptOption">
                    <input type="radio" name="provider" value="chatgpt">
                    <div class="radio-content">
                        <div class="radio-label">
                            <svg class="provider-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08-4.778 2.758a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"/>
                            </svg>
                            ChatGPT
                        </div>
                        <div class="radio-description">
                            Uses OpenAI ChatGPT API. Requires OpenAI API key.
                        </div>
                    </div>
                </label>
            </div>

            <button class="start-button" onclick="startChat()">
                Start Chatting ‚Üí
            </button>
        </div>
    </div>

    <!-- Main Chat Screen -->
    <div id="chatSection" style="display: none;">
        <div class="user-info-bar">
            <div class="provider-badge" id="currentProvider">
                <span class="badge-icon" id="providerIcon"></span>
                <span id="providerName"></span>
            </div>
            <button class="logout-button" onclick="changeProvider()">Change Provider</button>
        </div>

        <!-- Chat Interface (embedded from original) -->
        <div id="chatContent" style="height: calc(100vh - 60px); overflow: hidden;">
            <iframe src="index.html" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    <script>
        // Check if user already selected a provider
        function checkSession() {
            const provider = sessionStorage.getItem('selectedProvider');

            if (provider) {
                showChatSection(provider);
            } else {
                showLoginSection();
            }
        }

        function showLoginSection() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('chatSection').style.display = 'none';

            // Add click handlers to radio options
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    updateRadioStyles();
                });
            });

            // Update styles on radio change
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', updateRadioStyles);
            });

            updateRadioStyles();
        }

        function updateRadioStyles() {
            document.querySelectorAll('.radio-option').forEach(option => {
                const radio = option.querySelector('input[type="radio"]');
                if (radio.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        function startChat() {
            const selectedProvider = document.querySelector('input[name="provider"]:checked').value;

            // Save to session storage
            sessionStorage.setItem('selectedProvider', selectedProvider);

            // Redirect to appropriate auth route
            if (selectedProvider === 'github') {
                window.location.href = '/auth/github';
            } else if (selectedProvider === 'chatgpt') {
                window.location.href = '/auth/chatgpt';
            }
        }

        function showChatSection(provider) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('chatSection').style.display = 'block';

            // Update provider display
            const providerIcon = document.getElementById('providerIcon');
            const providerName = document.getElementById('providerName');

            if (provider === 'github') {
                providerIcon.textContent = '‚ú®';
                providerName.textContent = 'GitHub Copilot';
            } else if (provider === 'chatgpt') {
                providerIcon.textContent = 'ü§ñ';
                providerName.textContent = 'ChatGPT';
            }
        }

        function changeProvider() {
            if (confirm('Change AI provider? This will end your current session.')) {
                sessionStorage.removeItem('selectedProvider');
                window.location.href = '/auth/logout';
            }
        }

        // Initialize on page load
        checkSession();
    </script>
</body>
</html>
